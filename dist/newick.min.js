"use strict";!function(n){function e(n){if("string"==typeof n)try{n=JSON.parse(n)}catch(e){n=Newick.parse(n)}return n}function r(n){var e="";return n.branchset&&n.branchset.length&&(e+="("+n.branchset.map(r).join(",")+")"),null!=n.name&&(e+=n.name),null!=n.length&&(e+=":"+n.length),e}n.parse=function(n){for(var e=[],r={},t=n.split(/\s*(;|\(|\)|,|:)\s*/),a=0;a<t.length;a++){var h=t[a];switch(h){case"(":var l={};r.branchset=[l],e.push(r),r=l;break;case",":var l={};e[e.length-1].branchset.push(l),r=l;break;case")":r=e.pop();break;case":":break;default:var s=t[a-1];")"==s||"("==s||","==s?r.name=h:":"==s&&(r.length=parseFloat(h))}}return r},n.dfs=function(n,r,t){function a(n){var e=n.branchset||[];if(0!==e.length)for(var l=0;l<e.length;l++)r?r[e[l].name]&&(e[l].length=r[e[l].name]):(h[e[l].name]=e[l].length,n.branchset[l]=t(n.branchset[l])),a(e[l])}t=t||function(n){return n};var h={};return n=e(n),a(n),h},n.map=function(r,t){return t=t||function(n){return n},r=e(r),n.dfs(r,null,t),r},n.drown=function(n){function r(n){var e=n.branchset||[];if(n.hasOwnProperty("length")){for(var t=0,a=0;a<e.length;a++)t+=e[a].length;for(var h=n.length/t,a=0;a<e.length;a++)e[a].length+=e[a].length*h;0!=e.length&&(n.length=0),console.log(n)}for(var a=0;a<e.length;a++)r(e[a])}return n=e(n),r(n),n},n.normalize=function(r){function t(e){var r=n.dfs(e),t=0;for(var a in r)r.hasOwnProperty(a)&&(t+=r[a]);return n.dfs(e,null,function(n){return n.length=n.length/t,n}),e}return r=e(r),t(r)},n.serialize=function(n){return n=e(n),r(n)+";"}}("undefined"!=typeof exports?exports:this.Newick={});